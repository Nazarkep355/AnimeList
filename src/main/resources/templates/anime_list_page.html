<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body>
<div th:insert="header.html:: header"></div>
<div style="background: black">
    <div class="container">
        <div class="container mx-1">
            <div style="background: white;">
                <div class="row">
                    <div class="col" style="min-width: 70%;">
                        <div class="container mx-1">
                            <div style="background: deepskyblue;min-height: 1000px"></div>
                        </div>
                    </div>
                    <div class="col" style="min-width: 28%;">
                        <div class="container mx-1">
                            <div style="min-height: 1000px">
                                <div id="topRating" ng-app="topRatingAnime">
                                    <div ng-controller="topCtrl">
                                        <div style="background: #dde1ec;" class="container"><strong
                                                style="color: #000;text-align: left;
                                        font-family: Avenir,lucida grande,tahoma,verdana,arial,sans-serif;">
                                            Top Rating
                                        </strong> <a href="/best100" style=" float: right;text-align: right;
                                        margin-left: 60px;color: darkblue;text-decoration:none;">Top 100</a></div>
                                        <div style="max-height: 600px">
                                            <div ng-repeat="anime in bestAnimes">
                                                <div style="max-height: 120px;min-height: 120px"
                                                     class="row container my-1">
                                                    <div class="col" style="max-width: 82px">
                                                        <a href="/anime/{{anime.title}}"> <img height="110px"
                                                                                               width="75px"
                                                                                               src="/images/{{anime.poster}}"/>
                                                        </a></div>
                                                    <div class="col" style="margin-left: 0px">
                                                        <div><a href="/anime/{{anime.title}}"
                                                                style="color: darkblue;text-decoration:none;font-size: 13px">{{anime.title}}</a>
                                                        </div>
                                                        <div>
                                                            genre:Action, rate:{{anime.rate | number:2}}
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <script>
                                        topRating = angular.module('topRatingAnime', [])
                                        topRating.controller("topCtrl", function ($scope, $http) {
                                            $scope.bestAnimes = []
                                            $scope.rates=[]
                                            $scope.setTop = function () {
                                                $http.get('/best?quantity=5').then(function (response) {
                                                    $scope.bestAnimes = response.data;
                                                    $scope.getRates()
                                                }, function (error) {
                                                    alert(error.message)
                                                })
                                            }


                                            $scope.getRate= function (anime) {
                                                $http.get('/rating/'+anime.id).then(function (response) {
                                                    console.log(response.data)
                                                   anime.rate= response.data;
                                                }, function (error) {
                                                    alert(error.message)
                                                })
                                            }
                                            $scope.getRates=function (){
                                                for(i=0;i<$scope.bestAnimes.length;i++){
                                                    $scope.getRate($scope.bestAnimes[i])
                                                }
                                            }
                                            $scope.setTop();


                                        })

                                        angular.bootstrap(document.getElementById('topRating'), ['topRatingAnime'])

                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
</html>